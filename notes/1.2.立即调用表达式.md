# 1.2 立即调用表达式

从这一节开始我们开始理解 jQuery 的源码，打开源码发现整个 jQuery 代码是一个匿名函数，这个匿名函数有两个形参 window 和 undefined，这一节我们主要深入的理解一下这两个形参

整个 jq 的源代码都包含在一个立即执行的匿名函数中

```
(function(window,undefined){
  ...
})(window)
```

```
(function( $, undefined ) {})(jQuery); // 同理
```

因为 ECMAscript 执行 JS 代码是从里到外的，因此把全局变量 window 或 jQuery 对象传进来，避免去外层寻找，提高效率。undefined 在老一辈的浏览器是不被支持的，直接使用会报错，js 框架要考虑到兼容性，因此增加一个形参 undefined。

还有，不要使用 window.undefined 传递形参，有可能 window.undefined 被其他人修改了,最好就是什么都不传，形参的 undefined 就是真正的 undefined 了。

代码：

```
var undefined = 10;
(function(window){
  console.log(window.undefined); // 10
  console.log(undefined); // 10
})()
```

与代码：

```
var undefined = 10;
(function(window,undefined){
  console.log(window.undefined); // 10
  console.log(undefined); // undefined ,此处undefined参数为局部的名称为undefined变量，值为undefined
})()
```

区分上述两种方式：第一种每个语句都要去最外层全局找一次 window。第二种将 window 作为参数传递过去，不用每个语句都去最外层全局找一次 window，提高了效率；加入要在函数中为 window 再设置 n 个属性，只需要去最外层找一次 window 对象。第二种代码中的 undefined，就算有其他人把外层的 undefined 定义了，函数里面的 undefined 依然不受影响。最大程度的防止外界的变量定义对所做封装的内部造成影响。

```
(function( $, undefined ) {})(jQuery); // 同理
```

例如

```
var undefined = 100;
(function($,undefined){
  // code
})(jQuery)
```

这里传一个 undefined 的形参，避免上面的外层定义，只要没有传值进入函数，unddefined 就不会被赋值

任何库与框架设计的第一个要点就是解决命名空间与变量污染的问题。jQuery 就是利用了 Javascript 函数作用域的特性，采用立即调用表达式包裹了自身的方法来解决这个问题。

```
(function(window, undefined) {
    var jQuery = function() {}
    // ...
    window.jQuery = window.$ = jQuery;
})(window);
```

自动初始化这个函数，让其只构建一次，详细说一下这种写法的优势：
1、window 和 undefined 都是为了减少变量查找所经过的 scope 作用于。当 window 通过传递给闭包内部之后，在闭包内部使用它的时候，可以把它当成一个局部变量，显然比原先在 window scope 下查找的时候要快一些。
2、undefined 也是同样的道理，其实这个 undefined 并不是 JavaScript 数据类型的 undefined，而是一个普普通通的变量名。只是因为没给它传递值，它的值就是 undefined，undefined 并不是 JavaScript 的保留字。

Javascript 中的 undefined 并不是作为关键字，因此可以允许用户对其赋值。

如果函数调用不传递，参数默认就是 undefined
